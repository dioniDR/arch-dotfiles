# ███╗   ███╗ ██████╗ ███╗   ██╗██╗████████╗ ██████╗ ██████╗ 
# ████╗ ████║██╔═══██╗████╗  ██║██║╚══██╔══╝██╔═══██╗██╔══██╗
# ██╔████╔██║██║   ██║██╔██╗ ██║██║   ██║   ██║   ██║██████╔╝
# ██║╚██╔╝██║██║   ██║██║╚██╗██║██║   ██║   ██║   ██║██╔══██╗
# ██║ ╚═╝ ██║╚██████╔╝██║ ╚████║██║   ██║   ╚██████╔╝██║  ██║
# ╚═╝     ╚═╝ ╚═════╝ ╚═╝  ╚═══╝╚═╝   ╚═╝    ╚═════╝ ╚═╝  ╚═╝

# CONFIGURACIÓN CORREGIDA PARA HYPRLAND 0.49+
# Sintaxis actualizada según la nueva estructura

# ============================================================
# SCREENSHOT COMPRESSION QUALITY
# ============================================================
$SCREENSHOT_QUALITY = 30

# ============================================================
# DEBUG CONFIGURATION
# ============================================================
# Logs deshabilitados para arranque/apagado más limpio
# Para depuración: cambiar disable_logs a false
# Fecha: 18/08/2025 - Motivo: Sesiones largas con logs excesivos
debug {
    disable_logs = true        # Deshabilita logs en stdout
    enable_stdout_logs = false # Evita spam en terminal
}
# Para reactivar debugging: comentar todo el bloque debug
# ============================================================

# ============================================================
# SILENT MODE CONFIGURATION  
# ============================================================
# Configuraciones adicionales para minimizar ruido del sistema
# Fecha: 18/08/2025 - Optimización para inicio/apagado silencioso

# Variables de entorno para reducir verbosidad
env = HYPRLAND_LOG_WLR,0              # Reduce logs de wlroots - SEGURO
# env = WLR_NO_HARDWARE_CURSORS,1     # COMENTADO: Solo si hay problemas de cursor
env = WLR_RENDERER_ALLOW_SOFTWARE,1   # Permite fallback silencioso - SEGURO
env = LIBVA_DRIVER_NAME,auto          # Auto-detección silenciosa - SEGURO
# ============================================================

# Monitor configuration
monitor=,preferred,auto,auto

# Environment variables for Wayland
env = XCURSOR_SIZE,24
env = QT_QPA_PLATFORM,wayland
env = QT_QPA_PLATFORMTHEME,qt5ct
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = MOZ_ENABLE_WAYLAND,1
env = GDK_BACKEND,wayland,x11
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland

# Variables adicionales para reducir mensajes de advertencia - SEGURAS
env = QT_LOGGING_RULES,*=false                    # Reduce logs de Qt
env = GSK_RENDERER,gl                             # Fuerza renderer GL estable
env = GDK_DEBUG,0                                 # Reduce debug de GTK

# Input configuration
input {
    kb_layout = us
    kb_variant =
    kb_model =
    kb_options =
    kb_rules =
    follow_mouse = 1
    touchpad {
        natural_scroll = yes
        disable_while_typing = true
        tap-to-click = true
        drag_lock = false
        tap-and-drag = true
    }
    sensitivity = 0
}

# General settings
general {
    gaps_in = 5
    gaps_out = 10
    border_size = 2
    col.active_border = rgba(33ccffee) rgba(00ff99ee) 45deg
    col.inactive_border = rgba(595959aa)
    layout = dwindle
    allow_tearing = false
}

# DECORACIÓN CORREGIDA - NUEVA SINTAXIS
decoration {
    rounding = 12
    
    # Shadows - Nueva sintaxis sin prefijos
    shadow {
        enabled = true
        range = 8
        render_power = 3
        color = rgba(1a1a1aaa)
        offset = 2 2
    }
    
    # Blur - Nueva estructura anidada
    blur {
        enabled = true
        size = 8
        passes = 2
        new_optimizations = true
        xray = false
        vibrancy = 0.2
        vibrancy_darkness = 0.5
        noise = 0.01
        contrast = 0.9
        brightness = 0.8
        special = false
        ignore_opacity = true
    }
    
    # Opacidad
    active_opacity = 1.0
    inactive_opacity = 0.95
    fullscreen_opacity = 1.0
}

# ANIMACIONES ACTUALIZADAS
animations {
    enabled = true
    
    # Curvas de animación suaves
    bezier = wind, 0.05, 0.9, 0.1, 1.05
    bezier = winIn, 0.1, 1.1, 0.1, 1.1
    bezier = winOut, 0.3, -0.3, 0, 1
    bezier = liner, 1, 1, 1, 1
    
    # Animaciones de ventanas
    animation = windows, 1, 6, wind, slide
    animation = windowsIn, 1, 6, winIn, slide
    animation = windowsOut, 1, 5, winOut, slide
    animation = windowsMove, 1, 5, wind, slide
    
    # Animaciones de bordes y fade
    animation = border, 1, 1, liner
    animation = borderangle, 1, 30, liner, loop
    animation = fade, 1, 10, default
    
    # Animaciones de espacios de trabajo
    animation = workspaces, 1, 5, wind
    animation = specialWorkspace, 1, 6, wind, slidevert
}

# Dwindle layout
dwindle {
    pseudotile = yes
    preserve_split = yes
}

# Master layout
master {
    new_status = master
}

# Gestures - Sintaxis horizontal
gesture = 3, horizontal, workspace

# Solo gestos con nueva sintaxis

# Misc settings - ACTUALIZADAS
misc {
    force_default_wallpaper = 0          # CAMBIADO: Usa hyprpaper personalizado
    disable_hyprland_logo = true          # CAMBIADO: Deshabilita logo para inicio silencioso
    mouse_move_enables_dpms = true
    enable_swallow = true
    swallow_regex = ^(kitty)$
    focus_on_activate = false
    animate_manual_resizes = true
    animate_mouse_windowdragging = true
    vfr = true
    disable_splash_rendering = true       # AÑADIDO: Deshabilita splash screen
    # no_direct_scanout = false           # COMENTADO: No existe en esta versión
    # suppress_portal_warnings = true     # COMENTADO: No existe en esta versión
    new_window_takes_over_fullscreen = 2 # AÑADIDO: Mejor manejo de ventanas
}

# Variables
$mainMod = SUPER

# Keybindings
bind = $mainMod, T, exec, kitty
bind = $mainMod, Q, killactive
bind = $mainMod, M, exit
bind = $mainMod, E, exec, thunar
bind = $mainMod, V, togglefloating
bind = $mainMod, R, exec, wofi --show drun
bind = $mainMod, P, pseudo
bind = $mainMod, J, togglesplit

# Quick Notes - Mousepad floating
bind = $mainMod SHIFT, N, exec, [float; size 600 400; center] mousepad
bind = $mainMod, F, fullscreen
bind = $mainMod, L, exec, hyprlock

# Keybindings Alternativos
bind = CTRL_ALT, T, exec, kitty -e zsh

# Print Screen keybindings
bind = , Print, exec, grim - | convert - -quality $SCREENSHOT_QUALITY ~/Pictures/captura-$(date +'%Y%m%d_%H%M%S').jpg
bind = SHIFT, Print, exec, grim -g "$(slurp)" - | convert - -quality $SCREENSHOT_QUALITY ~/Pictures/captura-area-$(date +'%Y%m%d_%H%M%S').jpg
bind = ALT, Print, exec, grim -g "$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')" - | convert - -quality $SCREENSHOT_QUALITY ~/Pictures/captura-ventana-$(date +'%Y%m%d_%H%M%S').jpg

# Print Screen to clipboard (Ctrl variants)
bind = CTRL, Print, exec, grim - | wl-copy
bind = CTRL_SHIFT, Print, exec, grim -g "$(slurp)" - | wl-copy
bind = CTRL_ALT, Print, exec, grim -g "$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')" - | wl-copy
bind = SUPER, Print, exec, grim - | magick - -enhance -sharpen 0x1 - | tesseract stdin stdout | wl-copy
bind = SUPER_SHIFT, Print, exec, grim -g "$(slurp)" - | magick - -enhance -sharpen 0x1 - | tesseract stdin stdout | wl-copy
bind = SUPER_ALT, Print, exec, grim -g "$(hyprctl activewindow -j | jq -r '"\(.at[0]),\(.at[1]) \(.size[0])x\(.size[1])"')" - | magick - -enhance -sharpen 0x1 - | tesseract stdin stdout | wl-copy

# Function keys for brightness, volume, and media control
# XF86 keys (típicamente Fn+F# o cuando Fn Lock está activado)
bind = , XF86BrightnessUp, exec, brightnessctl set 10%+
bind = , XF86BrightnessDown, exec, brightnessctl set 10%-
bind = , XF86AudioRaiseVolume, exec, pamixer -i 5
bind = , XF86AudioLowerVolume, exec, pamixer -d 5
bind = , XF86AudioMute, exec, pamixer -t
bind = , XF86AudioPlay, exec, playerctl play-pause
bind = , XF86AudioPause, exec, playerctl play-pause
bind = , XF86AudioNext, exec, playerctl next
bind = , XF86AudioPrev, exec, playerctl previous
bind = , XF86MonBrightnessUp, exec, brightnessctl set 10%+
bind = , XF86MonBrightnessDown, exec, brightnessctl set 10%-

# Bindings alternativos para teclas F directas (cuando Fn Lock está desactivado)
# Estas funcionarán independientemente del estado del Fn Lock
bind = , F5, exec, brightnessctl set 10%-
bind = , F6, exec, brightnessctl set 10%+
bind = , F11, exec, pamixer -d 5
bind = , F12, exec, pamixer -i 5
bind = , F7, exec, playerctl previous
bind = , F8, exec, playerctl next

# Bindings duplicados con Alt para acceso alternativo si es necesario
# En caso de que Fn Lock cause conflictos, puedes usar Alt+F#
bind = ALT, F1, exec, ~/arch-dotfiles/.help-system/launch-help.sh
bind = ALT, F2, exec, /home/dioni/labs/quickassist/launch.sh
bind = ALT, F3, exec, /home/dioni/arch-dotfiles/docs/interfaces/f3-ollama/launch-f3.sh

# Microphone control (Multiple options for compatibility)
bind = , F9, exec, pamixer --default-source --toggle-mute
bind = , F10, exec, /home/dioni/.local/bin/mic-volume-cycle.sh

# Alternative microphone bindings (if F9/F10 don't work)
bind = ALT, F9, exec, pamixer --default-source --toggle-mute
bind = ALT, F10, exec, /home/dioni/.local/bin/mic-volume-cycle.sh
bind = CTRL SHIFT, M, exec, pamixer --default-source --toggle-mute

# Move focus with mainMod + arrow keys
bind = $mainMod, left, movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up, movefocus, u
bind = $mainMod, down, movefocus, d

# Switch workspaces with mainMod + [0-9]
bind = $mainMod, 1, workspace, 1
bind = $mainMod, 2, workspace, 2
bind = $mainMod, 3, workspace, 3
bind = $mainMod, 4, workspace, 4
bind = $mainMod, 5, workspace, 5
bind = $mainMod, 6, workspace, 6
bind = $mainMod, 7, workspace, 7
bind = $mainMod, 8, workspace, 8
bind = $mainMod, 9, workspace, 9
bind = $mainMod, 0, workspace, 10

# Move active window to a workspace with mainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, movetoworkspace, 1
bind = $mainMod SHIFT, 2, movetoworkspace, 2
bind = $mainMod SHIFT, 3, movetoworkspace, 3
bind = $mainMod SHIFT, 4, movetoworkspace, 4
bind = $mainMod SHIFT, 5, movetoworkspace, 5
bind = $mainMod SHIFT, 6, movetoworkspace, 6
bind = $mainMod SHIFT, 7, movetoworkspace, 7
bind = $mainMod SHIFT, 8, movetoworkspace, 8
bind = $mainMod SHIFT, 9, movetoworkspace, 9
bind = $mainMod SHIFT, 0, movetoworkspace, 10

# Scroll through existing workspaces with mainMod + scroll
bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1

# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Autostart applications
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = /usr/lib/polkit-gnome/polkit-gnome-authentication-agent-1
exec-once = hypridle
exec-once = waybar
exec-once = mako
exec-once = nm-applet --indicator
exec-once = blueman-applet
exec-once = udiskie --tray --no-notify    # CAMBIADO: Deshabilita notificaciones de montaje
exec-once = libinput-gestures-setup start
exec-once = /usr/lib/xdg-desktop-portal-hyprland
exec-once = /usr/lib/xdg-desktop-portal

# Knowledge Base System autostart (silencioso)
exec-once = systemctl --user start knowledge-base.service --quiet    # CAMBIADO: Modo silencioso

# REGLAS DE VENTANA ACTUALIZADAS
# Knowledge Base System window rules
windowrulev2 = float,title:^(Knowledge Base).*
windowrulev2 = size 1200 800,title:^(Knowledge Base).*
windowrulev2 = center,title:^(Knowledge Base).*
windowrulev2 = opacity 0.95 0.95,title:^(Knowledge Base).*

# Terminal transparente con blur
windowrulev2 = opacity 0.9 0.9,class:^(kitty)$
windowrulev2 = opacity 0.9 0.9,class:^(Alacritty)$

# Aplicaciones que se ven mejor sin blur
windowrulev2 = noblur,class:^(firefox)$
windowrulev2 = noblur,class:^(chromium)$

# Ventanas flotantes con mejor opacidad
windowrulev2 = opacity 0.95 0.95,floating:1

# Aplicaciones de medios sin efectos para mejor rendimiento
windowrulev2 = noblur,class:^(mpv)$
windowrulev2 = noblur,class:^(vlc)$
windowrulev2 = noshadow,class:^(mpv)$
windowrulev2 = noshadow,class:^(vlc)$

# F1 Help System
bind = , F1, exec, ~/arch-dotfiles/.help-system/launch-help.sh

# F2 quickassist app
bind = , F2, exec, /home/dioni/labs/quickassist/launch.sh

# Ollama-lab F3 binding - CORREGIDO
bind = , F3, exec, /home/dioni/arch-dotfiles/docs/interfaces/f3-ollama/launch-f3.sh

# Wallpaper con hyprpaper - Dynamic Wallpapers
exec-once = hyprpaper

# Dynamic Wallpaper System - Configura wallpaper inicial
exec-once = /home/dioni/.local/bin/dwall-hypr firewatch

# ========================================
# REGLAS PARA DIÁLOGOS DE ARCHIVOS
# ========================================

# Claude Desktop (Electron) - Diálogos de archivos
windowrulev2 = float, title:^(Open Files)$
windowrulev2 = size 800 600, title:^(Open Files)$
windowrulev2 = center, title:^(Open Files)$

# Firefox - Diálogos de subida de archivos
windowrulev2 = float, class:^(firefox)$, title:^(File Upload)$
windowrulev2 = size 700 500, class:^(firefox)$, title:^(File Upload)$
windowrulev2 = center, class:^(firefox)$, title:^(File Upload)$

# Reglas genéricas para todos los diálogos de archivos
windowrulev2 = float, title:^(Open File)(.*)$
windowrulev2 = float, title:^(Save File)(.*)$
windowrulev2 = float, title:^(Choose Files)(.*)$
windowrulev2 = float, title:^(Select Files)(.*)$

windowrulev2 = size 750 550, title:^(Open File)(.*)$
windowrulev2 = size 750 550, title:^(Save File)(.*)$
windowrulev2 = size 750 550, title:^(Choose Files)(.*)$
windowrulev2 = size 750 550, title:^(Select Files)(.*)$

windowrulev2 = center, title:^(Open File)(.*)$
windowrulev2 = center, title:^(Save File)(.*)$
windowrulev2 = center, title:^(Choose Files)(.*)$
windowrulev2 = center, title:^(Select Files)(.*)$

# Portales de escritorio (xdg-desktop-portal)
windowrulev2 = float, class:^(org.freedesktop.impl.portal.desktop.gtk)$
windowrulev2 = size 700 500, class:^(org.freedesktop.impl.portal.desktop.gtk)$
windowrulev2 = center, class:^(org.freedesktop.impl.portal.desktop.gtk)$

# Thunar configuración
windowrulev2 = opacity 0.75, class:^(thunar)$
windowrulev2 = float, class:^(thunar)$, title:^(Open)(.*)$
windowrulev2 = size 700 500, class:^(thunar)$, title:^(Open)(.*)$
windowrulev2 = center, class:^(thunar)$, title:^(Open)(.*)$
# ========================================
# LINUX/WINDOWS USEFUL KEYBINDS
# ========================================

# Alt+Tab window switching (Linux standard)
bind = ALT, TAB, cyclenext
bind = ALT SHIFT, TAB, cyclenext, prev

# Task manager (Linux/Windows standard)
bind = CTRL SHIFT, Escape, exec, kitty -e htop

# Power/logout menu (Linux standard)  
bind = CTRL ALT, Delete, exec, wlogout

# Windows-style desktop toggle
bind = $mainMod, D, exec, hyprctl dispatch togglespecialworkspace

# Quick system settings (Windows-style)
bind = $mainMod, I, exec, gnome-control-center

# Emoji picker (Windows-style)
bind = $mainMod, period, exec, wofi-emoji

# Window snapping (Windows-style productivity)
bind = $mainMod SHIFT, left, movewindow, l
bind = $mainMod SHIFT, right, movewindow, r
bind = $mainMod SHIFT, up, movewindow, u  
bind = $mainMod SHIFT, down, movewindow, d

# ========================================

# ========================================
# MOVER VENTANA ACTIVA ENTRE ESPACIOS
# ========================================
# Super + Shift + flechas para mover ventana activa a otro workspace
bind = SUPER SHIFT, left, movetoworkspacesilent, e-1
bind = SUPER SHIFT, right, movetoworkspacesilent, e+1
# ========================================

# Gestos personalizados con libinput-gestures
# Estos requieren libinput-gestures configurado
# Para 3 dedos hacia arriba: wofi
# Para 3 dedos hacia abajo: cerrar ventana


